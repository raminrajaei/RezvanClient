@page "/child/all"
@page "/child/all/{FromAddNewChildPage:int}"

@using ATA.HR.Client.Web.APIs.Insurance.Models.Responses
@using Microsoft.AspNetCore.Components
@using ATA.HR.Client.Web.APIs.Models.Response
@inherits BitPageBase

<PageTitle>
    @PageTitles.ChildStudentsPage.Title
</PageTitle>

<TelerikLoaderContainer Text="" Visible="@IsLoading" />
<TelerikLoaderContainer Text="Uploading The Document" Visible="@IsUploading" LoaderType="LoaderType.ConvergingSpinner" />

<article>

    <div class="personnel-page">

        <!-- AddOrEdit Header -->
        <section>
            @if (PageOperationType is OperationType.Add or OperationType.Edit or OperationType.Custom1)
            {
                <HeaderAddOrEdit>
                    @if (IsNavigatedFromAddNewChildPage is false)
                    {
                        <button class="default-button" @onclick="ChangeToFilterMode">انصراف</button>
                    }
                    <button type="submit" form="costForm" class="primary-button">ذخیره</button>
                </HeaderAddOrEdit>
            }
        </section>

        <!-- Page Heading Title -->
        <section class="page-header-section">
            <div class="page-header-wrapper">
                <div class="flex align-items-center">
                    <TopBar PageName="@PageTitles.ChildStudentsPage.Title" PageDescription="مشاهده‌ی همه‌ی کودکانی که ثبت کرده‌اید" />
                </div>

                @if (PageOperationType == OperationType.Filter)
                {
                    <div class="flex">
                        @*<button class="default-button" style="margin-left: 20px" @onclick="BackButtonHandler">بازگشت</button>*@
                        <RadzenButton class="primary-button" Text="افزودن کودک" Click="OpenAddNewChildPage" />
                    </div>
                }
            </div>
        </section>

        <!-- Filter -->
        <section class="filter-section">
            @if (PageOperationType == OperationType.Filter)
            {
                <div class="page-box-wrapper">
                    <div class="row">
                        <div class="col-12 col-md-6 col-xl-6 col-xxl-3">
                            <label class="input-label">
                                کودک
                            </label>
                            <div class="searchbar-custom-wrapper">
                                <img src="@IconUrls.Search" />
                                <TelerikTextBox class="full-width"
                                                PlaceHolder="جستجو با نام یا نام خانوادگی یا شماره شناسنامه"
                                                ValueChanged="SearchTermChanged">
                                </TelerikTextBox>
                            </div>
                        </div>

                        <div class="col-12 col-md-6 col-xxl-3 filter-box">
                            <label>سال ثبت نام</label>
                            <div>
                                <RadzenNumeric id="year"
                                               Style="width: 100%"
                                               @bind-Value="ChildrenFilter.Year"
                                               Placeholder="سال" />
                            </div>
                        </div>
                    </div>
                </div>
            }
        </section>

        <!-- Grid -->
        <section class="grid-section">
            <div class="page-grid-wrapper mt-4">

                @if (true)
                {
                    <div class="page-grid-operation-wrapper align-items-center" style="flex-direction: row;
                                                                                       justify-content: space-between;">

                        <div>&nbsp;</div>
                        <div class="flex justify-content-end align-items-center" style="margin-top: -20px">

                            <TelerikButton Class="secondary-button excel-button contracts-excel-button" ImageUrl="@IconUrls.Export" OnClick="ExportCostsDataToExcel"> خروجی Excel </TelerikButton>

                        </div>
                    </div>
                }


                <TelerikGrid TItem="@ChildrenOutputDto"
                @ref="@ChildrenGridRef"
                             Height="100%"
                             Pageable="true"
                             PageSize="PageSize"
                             Sortable="true"
                             Groupable="false"
                             SelectionMode="Telerik.Blazor.GridSelectionMode.Multiple"
                @bind-SelectedItems="SelectedItems"
                             Resizable="true"
                             Reorderable="true"
                             OnStateInit="@OnStateInitHandler"
                             OnRowRender="OnGridRowRender"
                             OnRead=@OnReadHandler>
                    <GridColumns>
                        <GridCheckboxColumn Visible="@(IsVisibleMultipleActionButton && IsMultiActionOnCustomSelection)" CheckBoxOnlySelection="true" SelectAllMode="GridSelectAllMode.Current"></GridCheckboxColumn>
                        <GridColumn Field="@(nameof(ChildrenOutputDto.Id))" Title="شناسه" Width="100px" Locked="false" Sortable="false" />
                        <GridColumn Field="@(nameof(ChildrenOutputDto.FullName))" Title="نام و نام خانوادگی" Width="150px" Locked="false" Sortable="false" />
                        <GridColumn Field="@(nameof(ChildrenOutputDto.IdNo))" Title="شماره‌ی شناسنامه" Width="150px" Locked="false" Sortable="false" />
                        <GridColumn Field="@(nameof(ChildrenOutputDto.FatherName))" Title="نام پدر" Width="100px" Locked="false" Sortable="false" />
                        <GridColumn Field="@(nameof(ChildrenOutputDto.MotherName))" Title="نام مادر" Width="100px" Locked="false" Sortable="false" />
                        <GridColumn Field="@(nameof(ChildrenOutputDto.BirthDateJalali))" Title="تاریخ تولد" Width="100px" Locked="false" Sortable="false" />
                        <GridColumn Field="@(nameof(CostDto.Id))" Title="عملیات" Width="130px" Locked="true" Sortable="false">
                            <Template Context="gridContext">
                                @{
                                    var child = (ChildrenOutputDto)gridContext;

                                    <div class="grid-action-buttons-wrapper justify-content-center">

                                        <button class="grid-action-button edit" style="margin-right: 0" title="ویرایش" @onclick="@(() => OpenEditChildPage((int)child.Id))">
                                            <img class="btn-img" src="@IconUrls.PenOrange" />
                                            <img class="btn-img-hovered" src="@IconUrls.PenWhite" />
                                        </button>

                                        <button style="margin-right: 3px;" class="grid-action-button delete" title="حذف" @onclick="@(() => ShowDeleteChildConfirmDialog(child.Id))">
                                            <img class="btn-img" src="@IconUrls.TrashRed" />
                                            <img class="btn-img-hovered" src="@IconUrls.TrashWhite" />
                                        </button>

                                        <button style="margin-left: 3px;margin-right: 3px;" class="grid-action-button view"
                                                title="مشاهده" @onclick="@(() => OpenChildPrintPage(child.Id))">
                                            <img class="btn-img" src="@IconUrls.EyeGreen" />
                                            <img class="btn-img-hovered" src="@IconUrls.EyeWhite" />
                                        </button>


                                    </div>
                                }
                            </Template>
                        </GridColumn>
                    </GridColumns>
                </TelerikGrid>
            </div>
        </section>

        <!-- Popup Windows => Confirm Document Deletion -->
        <section>
            <ConfirmDialog @bind-IsVisible="IsVisibleDeleteChildConfirmDialog"
                           Title="تایید حذف کودک"
                           Text="این کودک به طور کامل از لیست موسسه حذف خواهد شد. آیا از حذف آن اطمینان دارید؟"
                           OnConfirm="() => DeleteChild(DeletingChildId)" />
        </section>
    </div>
</article>
